generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(uuid())
  username      String         @unique
  name          String
  email         String         @unique
  bio           String?
  pictureUrl    String?        @map("picture_url")
  createdAt     DateTime       @default(now()) @map("created_at")
  likes         Like[]
  marks         Mark[]
  readings      Reading[]
  refreshTokens RefreshToken[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model MagicLink {
  id        String   @id @default(uuid())
  email     String
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("magic_links")
}

model BibleBook {
  id            String         @id @default(uuid())
  name          String         @unique
  order         Int            @unique
  testament     Testament
  totalChapters Int            @map("total_chapters")
  chapters      BibleChapter[]

  @@index([order])
  @@map("bible_books")
}

model BibleChapter {
  id          String       @id @default(uuid())
  bookId      String       @map("book_id")
  number      Int
  totalVerses Int          @map("total_verses")
  book        BibleBook    @relation(fields: [bookId], references: [id])
  verses      BibleVerse[]

  @@unique([bookId, number])
  @@index([bookId, number])
  @@map("bible_chapters")
}

model BibleVerse {
  id        String       @id @default(uuid())
  chapterId String       @map("chapter_id")
  number    Int
  text      String
  chapter   BibleChapter @relation(fields: [chapterId], references: [id])
  likes     Like[]
  marks     Mark[]
  readings  Reading[]

  @@unique([chapterId, number])
  @@index([chapterId, number])
  @@map("bible_verses")
}

model Reading {
  id      String      @id @default(uuid())
  userId  String      @map("user_id")
  verseId String      @map("verse_id")
  mode    ReadingMode
  readAt  DateTime    @default(now()) @map("read_at")
  user    User        @relation(fields: [userId], references: [id])
  verse   BibleVerse  @relation(fields: [verseId], references: [id])

  @@index([userId, readAt])
  @@index([verseId])
  @@map("readings")
}

model Like {
  id        String     @id @default(uuid())
  userId    String     @map("user_id")
  verseId   String     @map("verse_id")
  createdAt DateTime   @default(now()) @map("created_at")
  user      User       @relation(fields: [userId], references: [id])
  verse     BibleVerse @relation(fields: [verseId], references: [id])

  @@unique([userId, verseId])
  @@index([userId])
  @@map("likes")
}

model Mark {
  id           String     @id @default(uuid())
  userId       String     @map("user_id")
  verseId      String     @map("verse_id")
  selectedText String     @map("selected_text")
  annotation   String?    @map("anotacao")
  isPublic     Boolean    @default(false) @map("is_public")
  createdAt    DateTime   @default(now()) @map("created_at")
  user         User       @relation(fields: [userId], references: [id])
  verse        BibleVerse @relation(fields: [verseId], references: [id])

  @@index([userId, isPublic])
  @@index([verseId])
  @@map("marks")
}

enum Testament {
  OLD
  NEW
}

enum ReadingMode {
  DISCOVERY
  JOURNEY
}
